YUI.add("notification-view",function(t,e){var i=require("hermes-core/flog")(e);t.flutil;t.namespace("Views")[this.name]=t.Base.create("notification-view",t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.notifId=t.id,this.object=t.object,this.objectType=t.objectType,this.subevents=t.events,this.isMuted=t.isMuted,this.notifModel=t.notifModel,this},loadState:function(){var e=this,i=[this.appContext.getModelRegistry("photo-group-invitations-models").then(function(t){e.invitationsModelRegistry=t})];return t.Promise.all(i)},buildContainer:function(){var t={params:{object:this.object,type:this.objectType,event:this.subevents[0],subCount:this.subevents.length-1,viewer:this.appContext.getViewer(),eventCount:this.subevents.length,events:this.subevents,hasMenu:!0},templateName:"",photoTemplateName:null};switch(t.params.type){case"photo":this.handlePhotoNotificationType(t);break;case"person":this.handlePersonNotificationType(t);break;case"group":this.handleGroupNotificationType(t);break;case"discussion":this.handleDiscussionNotificationType(t);break;case"gallery":this.handleGalleryNotificationType(t);break;case"flickrmail":this.handleFlickrMailNotificationType(t);break;case"testimonial":this.handleTestimonialNotificationType(t);break;default:return}return t.photoTemplateName&&(t.params.details=this.templates(t.photoTemplateName)(t.params),t.templateName="notification-photo-shell"),t.params.notifTemplate=this.templates(t.templateName)(t.params),this.setContainerWithTemplate("notification",t.params),this},handlePhotoNotificationType:function(t){for(var e=0;e<t.params.events.length;e++)t.params.events[e].owner.url="/photos/"+t.params.events[e].owner.pathAlias||t.params.events[e].owner.id;switch("group-invite"!==t.params.event.type&&(t.params.people=this.getEventOwners(t.params.events),t.params.peopleCount=t.params.people.length,t.params.subPeopleCount=t.params.people.length-1),t.params.event.type){case"comment":t.photoTemplateName="notification-photo-comment";break;case"fave":t.photoTemplateName="notification-photo-fave";break;case"gallery":t.templateName="notification-added-to-gallery";break;case"people":t.photoTemplateName="notification-person",t.params.object.owner.isMe||(t.params.hasMenu=!1);break;case"tag":t.photoTemplateName="notification-tag";break;case"photo_comment_mention":t.photoTemplateName="notification-mention";break;case"group_invite":t.params.groups=this.getEventGroups(t.params.events),t.params.groupsCount=t.params.groups.length,t.params.subGroupsCount=t.params.groups.length-1,t.templateName="notification-photo-group-invite";break;case"note":t.photoTemplateName="notification-photo-note";break;case"share":t.photoTemplateName="notification-photo-share",t.params.hasMenu=!1;break;default:return}},handlePersonNotificationType:function(t){if(t.params.event)switch(t.params.event.type){case"contacted":t.params.event.owner.url="/photos/"+t.params.event.owner.pathAlias||t.params.event.owner.id,t.templateName="notification-person-follow";break;case"friend_join":t.templateName="notification-friend-join";break;case"upload":t.templateName="notification-person-upload";break;default:return}t.params.hasMenu=!1},handleGroupNotificationType:function(t){t.params.event&&"group_user_invite"===t.params.event.type&&(t.templateName="notification-group-invite",t.params.hasMenu=!1)},handleDiscussionNotificationType:function(t){if(t.params.event)switch(t.params.event.type){case"group_topic_new":t.templateName="notification-group-topic-new",t.params.hasMenu=!1;break;case"topic_reply":case"reply_reply":t.params.people=this.getEventOwners(t.params.events),t.params.peopleCount=t.params.people.length,t.params.subPeopleCount=t.params.people.length-1,t.params.replyUrl=t.params.object.url+"/"+t.params.event.replyId,t.templateName="notification-group-discussion-reply";break;default:return}},handleGalleryNotificationType:function(t){t.params.event&&"comment"===t.params.event.type&&(t.params.people=this.getEventOwners(t.params.events),t.params.peopleCount=t.params.people.length,t.params.subPeopleCount=t.params.people.length-1,t.templateName="notification-gallery-comment")},handleFlickrMailNotificationType:function(t){t.params.event&&"flickrmail"===t.params.event.type&&(t.templateName="notification-flickrmail"),t.params.hasMenu=!1},handleTestimonialNotificationType:function(t){t.params.event&&"testimonial"===t.params.event.type&&(t.templateName="notification-testimonial"),t.params.hasMenu=!1},activate:function(){var t=this.subevents[0],e={type:this.objectType,id:this.object.id,eventType:t.type,latestTimestamp:t.timestamp,isMuted:this.isMuted},i=this.get("container");return this.notificationsList=i.ancestor(".notifications-list"),this.listItem=i.ancestor("li.notification-list-item"),this.ctxMenuArrow=i.one(".notif-context-menu-caret"),this.notification=this.listItem.one(".notification"),this.ctxMenuArrow&&this.registerEventHandler(this.ctxMenuArrow.on("click",this.handleContextArrowClick.bind(this))),this.ctxMenu||(i.appendChild(this.templates("notification-context-menu")({})),this.ctxMenu=i.one(".notification-context-menu")),this.turnOffOption=this.ctxMenu.one(".turn-off-object-option"),this.turnOnOption=this.ctxMenu.one(".turn-on-object-option"),this.turnOffOption&&this.registerEventHandler(this.turnOffOption.on("click",this.handleMuteObjectClick.bind(this,e,!0))),this.turnOnOption&&this.registerEventHandler(this.turnOnOption.on("click",this.handleMuteObjectClick.bind(this,e,!1))),e.isMuted?(this.turnOffOption.addClass("hidden"),this.turnOnOption.removeClass("hidden"),this.notification.addClass("muted")):(this.turnOnOption.addClass("hidden"),this.turnOffOption.removeClass("hidden")),"group_invite"===t.type&&(this.actionContainer=i.one(".action-container"),this.acceptButton=this.actionContainer.one(".button.accept"),this.declineButton=this.actionContainer.one(".button.decline"),this.registerEventHandler(this.acceptButton.on("click",this.handleGroupInviteAcceptClick.bind(this))),this.registerEventHandler(this.declineButton.on("click",this.handleGroupInviteDeclineClick.bind(this)))),this},getTaggedPeople:function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],o={id:n.personTagged.id,name:n.personTagged.displayname,url:n.personTagged.profileURL},a=!1,s=0;s<e.length;s++)if(e[s].id===o.id){a=!0;break}a||e.push(o)}return e},getEventOwners:function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],o={id:n.owner.id,name:n.owner.displayname,url:n.owner.profileURL},a=!1,s=0;s<e.length;s++)if(e[s].id===o.id){a=!0;break}a||e.push(o)}return e},getEventGroups:function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],o={id:n.group.id,title:n.group.title,url:n.group.url,iconUrl:n.group.bestIconURL},a=!1,s=0;s<e.length;s++)if(e[s].id===o.id){a=!0;break}a||e.push(o)}return e},handleContextArrowClick:function(t){this.toggleContextMenu()},toggleContextMenu:function(){this.listItem.hasClass("expanded")?this.listItem.removeClass("expanded"):(this.notificationsList.all(".notification-list-item.expanded").each(function(t){t.removeClass("expanded")}),this.listItem.addClass("expanded"),this.ctxMenu.removeClass("fast-close"))},handleMuteObjectClick:function(t,e,i){var n=this,o={};o.object_type=t.type,o.object_id=t.id,o.event_type=t.eventType,o.mute_after=t.latestTimestamp,e?(n.turnOffOption.addClass("disabled"),this.notifModel.remoteUpdateMutedObjects(o,this.appContext).then(function(t){n.turnOffOption.addClass("hidden"),n.turnOffOption.removeClass("disabled"),n.turnOnOption.removeClass("hidden"),n.notification.addClass("muted"),n.toggleContextMenu()},function(t){n.turnOffOption.removeClass("disabled")})):(n.turnOnOption.addClass("disabled"),this.notifModel.remoteUpdateUnmutedObjects(o,this.appContext).then(function(t){n.turnOnOption.addClass("hidden"),n.turnOnOption.removeClass("disabled"),n.turnOffOption.removeClass("hidden"),n.notification.removeClass("muted"),n.listItem.hasClass("expanded")&&n.toggleContextMenu()},function(t){n.turnOnOption.removeClass("disabled")})),n.ctxMenu.addClass("fast-close")},handleGroupInviteAcceptClick:function(t){var e=this;return this.actionContainer.addClass("loading"),this.invitationsModelRegistry.remote.acceptInvitation({groupID:e.subevents[0].group.id,userID:e.appContext.getViewer().nsid,photoID:e.object.id},e.appContext).then(function(t){return e.actionContainer.removeClass("loading"),e.actionContainer.addClass("accepted"),e.removeNotification(),t}).catch(function(t){throw i.error("Error accepting invite to group",{err:t}),e.actionContainer.removeClass("loading"),t})},handleGroupInviteDeclineClick:function(t){var e=this;return this.actionContainer.addClass("loading"),this.invitationsModelRegistry.remote.declineInvitation({groupID:e.subevents[0].group.id,userID:e.appContext.getViewer().nsid,photoID:e.object.id},e.appContext).then(function(t){return e.actionContainer.removeClass("loading"),e.actionContainer.addClass("declined"),e.removeNotification(),t}).catch(function(t){throw i.error("Error declining invite to group",{err:t}),e.actionContainer.removeClass("loading"),t})},removeNotification:function(){var t=this,e=this.notifModel.getValue("notifications").getList();e=e.filter(function(e){return t.notifModel.getValue("notifications").remove({id:e.id}),t.notifId!==e.id}),this.notifModel.getValue("notifications").concat(e)}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-notifications","hermes-template-notification-photo-comment","hermes-template-notification-group-invite","hermes-template-notification-added-to-gallery","hermes-template-notification-photo-fave","hermes-template-notification-photo-shell","hermes-template-notification-person-follow","hermes-template-notification-person-upload","hermes-template-notification-tag","hermes-template-notification-person","hermes-template-notification-mention","hermes-template-notification-photo-group-invite","hermes-template-notification-photo-extra-info","hermes-template-notification-photo-note","hermes-template-notification-photo-share","hermes-template-notification-group-discussion-reply","hermes-template-notification-gallery-comment","hermes-template-notification-friend-join","hermes-template-notification-group-topic-new","hermes-template-notification-flickrmail","hermes-template-notification-testimonial","hermes-template-notification-context-menu","hermes-template-notification"],langBundles:["common","relative-dates","notifications"]});YUI.add("hermes-lang-relative-dates_es-us",function(e,_){e.Intl.add("hermes/relative-dates","es-US",{SECOND_LONG:["1 segundo"],SECONDS_LONG:["${time}"," segundos"],MINUTE_LONG:["1 min"],MINUTES_LONG:["${time}"," min"],HOUR_LONG:["1 hora"],HOURS_LONG:["${time}"," horas"],DAY_LONG:["1 Día"],DAYS_LONG:["${time}"," días"],MONTH_LONG:["1 mes"],MONTHS_LONG:["${time}","meses"],YEAR_LONG:["1 año"],YEARS_LONG:["${time}","años"],SECOND_SHORT:["1s"],SECONDS_SHORT:["de ","${time}"],MINUTE_SHORT:["1m"],MINUTES_SHORT:["${time}","m"],HOUR_SHORT:["1h"],HOURS_SHORT:["${time}","h"],DAY_SHORT:["1d"],DAYS_SHORT:["${time}","d"],MONTH_SHORT:["1mes"],MONTHS_SHORT:["${time}","meses"],YEAR_SHORT:["1a"],YEARS_SHORT:["${time}","a"],SECOND_LONG_FUTURE:["en 1 segundo"],SECONDS_LONG_FUTURE:["en ","${time}"," segundos"],MINUTE_LONG_FUTURE:["en 1 minuto"],MINUTES_LONG_FUTURE:["en ","${time}"," minutos"],HOUR_LONG_FUTURE:["en 1 hora"],HOURS_LONG_FUTURE:["en ","${time}"," horas"],DAY_LONG_FUTURE:["en 1 día"],DAYS_LONG_FUTURE:["en ","${time}"," días"],MONTH_LONG_FUTURE:["en 1 mes"],MONTHS_LONG_FUTURE:["en ","${time}"," meses"],YEAR_LONG_FUTURE:["en 1 año"],YEARS_LONG_FUTURE:["en ","${time}"," años"],FUTURE_SHORT_FUTURE:["en ","${time}"],SECOND_SHORT_FUTURE:["en 1 s"],SECONDS_SHORT_FUTURE:["en ","${time}"," s"],MINUTE_SHORT_FUTURE:["en 1 min"],MINUTES_SHORT_FUTURE:["en ","${time}"," min"],HOUR_SHORT_FUTURE:["en 1 h"],HOURS_SHORT_FUTURE:["en ","${time}"," h"],DAY_SHORT_FUTURE:["en 1 d"],DAYS_SHORT_FUTURE:["en ","${time}"," d"],MONTH_SHORT_FUTURE:["en 1 mes"],MONTHS_SHORT_FUTURE:["en ","${time}"," meses"],YEAR_SHORT_FUTURE:["en 1 año"],YEARS_SHORT_FUTURE:["en ","${time}"," años"],SECOND_LONG_PAST:["hace 1 segundo"],SECONDS_LONG_PAST:["hace ","${time}"," segundos"],MINUTE_LONG_PAST:["Hace 1 minuto"],MINUTES_LONG_PAST:["Hace ","${time}"," minutos"],HOUR_LONG_PAST:["Hace 1 hora"],HOURS_LONG_PAST:["hace ","${time}"," horas"],DAY_LONG_PAST:["hace 1 día"],DAYS_LONG_PAST:["${time}"," días atrás "],MONTH_LONG_PAST:["hace 1 mes"],MONTHS_LONG_PAST:["hace ","${time}"," meses"],YEAR_LONG_PAST:["hace 1 año"],YEARS_LONG_PAST:["hace ","${time}"," años"],SECOND_SHORT_PAST:["hace 1 s"],SECONDS_SHORT_PAST:["hace ","${time}"," s"],MINUTE_SHORT_PAST:["hace 1 min"],MINUTES_SHORT_PAST:["hace ","${time}"," min"],HOUR_SHORT_PAST:["hace 1 h"],HOURS_SHORT_PAST:["hace ","${time}"," h"],DAY_SHORT_PAST:["hace 1 d"],DAYS_SHORT_PAST:["hace ","${time}"," d"],MONTH_SHORT_PAST:["hace 1 mes"],MONTHS_SHORT_PAST:["hace ","${time}"," meses"],YEAR_SHORT_PAST:["hace 1 año"],YEARS_SHORT_PAST:["hace ","${time}"," años"],NO_DATE:["-"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-notifications_es-us",function(e,o){e.Intl.add("hermes/notifications","es-US",{NOTIF_PHOTO_FAVE:["<a href='","${ownerUrl}","'>","${owner}","</a> marcó tu ",{type:"select",valueName:"mediaType",options:{photo:["foto como favorita"],video:["video como favorito"],other:["foto como favorita"]}},"."],NOTIF_PHOTO_FAVE_MULTI:[{type:"plural",valueName:"count",options:{one:["<a href='","${ownerUrl}","'>","${owner}","</a> y <a href='","${secondUrl}","'>","${secondOwner}","</a> marcaron tu ",{type:"select",valueName:"mediaType",options:{photo:["foto como favorita"],video:["video como favorito"],other:["foto como favorita"]}}],other:["<a href='","${ownerUrl}","'>","${owner}","</a> y ","${count}"," personas más marcaron tu ",{type:"select",valueName:"mediaType",options:{photo:["foto como favorita"],video:["video como favorito"],other:["foto como favorita"]}}]}},"."],NOTIF_PERSON_FOLLOW:["¡<a href='","${ownerUrl}","'>","${owner}","</a> te está siguiendo!"],NOTIF_PHOTO_COMMENT_YOURS:['<a href="',"${personUrl}",'">',"${personName}","</a> comentó sobre tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}},"."],NOTIF_PHOTO_COMMENT_YOURS_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${firstPersonUrl}",'">',"${firstPersonName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}","</a> comentaron sobre tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}}],other:['<a href="',"${firstPersonUrl}",'">',"${firstPersonName}","</a> y ","${count}"," personas más comentaron sobre tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}}]}},"."],NOTIF_PHOTO_COMMENT_OTHER:['<a href="',"${personUrl}",'">',"${personName}","</a> comentó sobre ",{type:"select",valueName:"mediaType",options:{photo:["la foto"],video:["el video"],other:["la foto"]}},' de <a href="',"${ownerUrl}",'">',"${ownerName}","</a>."],NOTIF_PHOTO_COMMENT_OTHER_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${firstPersonUrl}",'">',"${firstPersonName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}","</a> comentaron sobre ",{type:"select",valueName:"mediaType",options:{photo:["la foto"],video:["el video"],other:["la foto"]}},' de <a href="',"${ownerUrl}",'">',"${ownerName}","</a>"],other:['<a href="',"${firstPersonUrl}",'">',"${firstPersonName}","</a> y ","${count}"," personas más comentaron sobre ",{type:"select",valueName:"mediaType",options:{photo:["la foto"],video:["el video"],other:["la foto"]}},' de <a href="',"${ownerUrl}",'">',"${ownerName}","</a>"]}},"."],NOTIF_MENTION:['<a href="',"${personUrl}",'">',"${personName}","</a> te mencionó en ",{type:"select",valueName:"mediaType",options:{photo:["una foto"],video:["un video"],other:["una foto"]}},"."],NOTIF_MENTION_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${personUrl}",'">',"${personName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}","</a>"],other:['<a href="',"${personUrl}",'">',"${personName}","</a> y ","${count}"," personas más"]}}," te mencionaron en ",{type:"select",valueName:"mediaType",options:{photo:["una foto"],video:["un video"],other:["una foto"]}},"."],NOTIF_PHOTO_GROUP_INVITE:["<a href='","${ownerUrl}","'>","${owner}","</a> te envió una invitación para añadir tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}}," al grupo <a href='","${groupUrl}","'>","${groupName}","</a>."],NOTIF_PHOTO_GROUP_INVITE_MULTI:["Te enviaron una invitación para añadir tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}}," ",{type:"plural",valueName:"count",options:{one:["a los grupos <a href='","${groupUrl}","'>","${groupName}","</a> y <a href='","${secondGroupUrl}","'>","${secondGroupName}","</a>"],other:["al grupo <a href='","${groupUrl}","'>","${groupName}","</a> y ","${count}"," grupos más"]}},"."],NOTIF_GROUP_USER_INVITE:['Recibiste una invitación para unirte al grupo <a href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_TAGS:['<a href="',"${personUrl}",'">',"${personName}","</a> etiquetó tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}},"."],NOTIF_TAGS_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${personUrl}",'">',"${personName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}","</a>"],other:['<a href="',"${personUrl}",'">',"${personName}","</a> y ","${count}"," personas más"]}}," etiquetó tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}},"."],NOTIF_GALLERY:["Tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}},' se añadió a la expo <a href="',"${galleryUrl}",'">',"${galleryName}","</a>."],NOTIF_GALLERY_MULTI:["Tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}}," se añadió a ",{type:"plural",valueName:"count",options:{one:['las expos <a href="',"${galleryUrl}",'">',"${galleryName}",'</a> y <a href="',"${secondGalleryUrl}",'">',"${secondGalleryName}","</a>"],other:['la expo <a href="',"${galleryUrl}",'">',"${galleryName}","</a> y ","${count}"," expos más"]}},"."],NOTIF_ADD_PERSON:['<a href="',"${personUrl}",'">',"${personName}","</a> etiquetó a otras personas en tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}},"."],NOTIF_ADD_PEOPLE:[{type:"plural",valueName:"count",options:{one:['<a href="',"${personUrl}",'">',"${personName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}","</a>"],other:['<a href="',"${personUrl}",'">',"${personName}","</a> y ","${count}"," personas más"]}}," etiquetaron a otras personas en tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}},"."],NOTIF_ADD_ME:['<a href="',"${ownerUrl}",'">',"${ownerName}","</a> te etiquetó en ",{type:"select",valueName:"mediaType",options:{photo:["una foto"],video:["un video"],other:["una foto"]}},"."],NOTIF_NOTES:['<a href="',"${personUrl}",'">',"${personName}","</a> dejó una nota en tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}},"."],NOTIF_NOTES_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${personUrl}",'">',"${personName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}","</a>"],other:['<a href="',"${personUrl}",'">',"${personName}","</a> y ","${count}"," personas más"]}}," dejaron notas en tu ",{type:"select",valueName:"mediaType",options:{photo:["foto"],video:["video"],other:["foto"]}},"."],NOTIF_NOTES_OTHER:['<a href="',"${personUrl}",'">',"${personName}",'</a> dejó una nota en la foto de <a href="',"${ownerUrl}",'">',"${ownerName}","</a>."],NOTIF_NOTES_OTHER_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${personUrl}",'">',"${personName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}",'</a> dejaron notas en la foto de <a href="',"${ownerUrl}",'">',"${ownerName}","</a>."],other:['<a href="',"${personUrl}",'">',"${personName}","</a> y ","${count}",' personas más dejaron notas en la foto de <a href="',"${ownerUrl}",'">',"${ownerName}","</a>."]}}],NOTIF_VIEW_RECENT_ACTIVITY:["Ver actividad reciente"],NOTIFICATIONS:["Notificaciones"],NOTIF_SHARE:['<a href="',"${personUrl}",'">',"${personName}","</a> compartió ",{type:"select",valueName:"mediaType",options:{photo:["una foto"],video:["un video"],other:["una foto"]}}," contigo."],FLICKR_MAIL_COUNT_PAREN:["(","${count}",")"],FLICKR_GROUP_DISCUSSION_REPLY:['<a href="',"${personUrl}",'">',"${personName}",'</a> respondió a la discusión <a href="',"${replyUrl}",'">',"${objectTitle}",'</a> en el grupo <a href="',"${groupUrl}",'">',"${groupName}","</a>."],FLICKR_GROUP_DISCUSSION_REPLY_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${personUrl}",'">',"${personName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}","</a>"],other:['<a href="',"${personUrl}",'">',"${personName}","</a> y ","${count}"," personas más"]}},' respondieron a la discusión <a href="',"${replyUrl}",'">',"${objectTitle}",'</a> en el grupo <a href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_GROUP_DISCUSSION_REPLY:['<a href="',"${personUrl}",'">',"${personName}",'</a> respondió a la discusión <a href="',"${replyUrl}",'">',"${objectTitle}",'</a> en el grupo <a href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_GROUP_DISCUSSION_REPLY_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${personUrl}",'">',"${personName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}","</a>"],other:['<a href="',"${personUrl}",'">',"${personName}","</a> y ","${count}"," personas más"]}},' respondieron a la discusión <a href="',"${replyUrl}",'">',"${objectTitle}",'</a> en el grupo <a href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_ONBOARDING_TITLE:["NUEVO: Centro de notificaciones"],NOTIF_ONBOARDING_DESCRIPTION:['Aquí encontrarás las notificaciones de tu actividad reciente en Flickr. Esto incluye el acceso sencillo a <a href="/mail">FlickrMail</a>. Creemos que disfrutarás lo que hemos hecho hasta ahora.'],NOTIF_GALLERY_COMMENT:['<a href="',"${personUrl}",'">',"${personName}",'</a> comentó sobre tu expo <a href="',"${objectUrl}",'">',"${objectName}","</a>."],NOTIF_GALLERY_COMMENT_MULTI:[{type:"plural",valueName:"count",options:{one:['<a href="',"${personUrl}",'">',"${personName}",'</a> y <a href="',"${secondPersonUrl}",'">',"${secondPersonName}",'</a> comentaron sobre tu expo <a href="',"${objectUrl}",'">',"${objectName}","</a>."],other:['<a href="',"${personUrl}",'">',"${personName}","</a> y ","${count}",' personas más comentaron sobre tu expo <a href="',"${objectUrl}",'">',"${objectName}","</a>."]}}],NOTIF_FRIEND_JOIN:['¡Tu amigo <a href="',"${personUrl}",'">',"${personName}","</a> se unió a Flickr!"],NOTIF_NEW_GROUP_DISCUSSION:['<a href="',"${personUrl}",'">',"${personName}",'</a> creó la discusión <a href="',"${discussionUrl}",'">',"${discussionName}",'</a> en el grupo <a href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_FLICKRMAIL:["<a href='","${personUrl}","'>","${personName}","</a> te envió un mensaje: <a href='","${mailUrl}","'>“","${mailTitle}","”</a>"],NOTIF_TURN_OFF_OBJECT:["Desactivar las notificaciones para esta publicación"],NOTIF_TURN_ON_OBJECT:["Activar las notificaciones para esta publicación"],NOTIF_HIDE_THIS:["Ocultar esta notificación"],NOTIF_NOTHING_HERE:["Cuando recibas notificaciones nuevas, aparecerán aquí."],NOTIF_OFF_FOR_POST:["Las notificaciones para esta publicación están desactivadas."],NOTIF_UNDO:["Deshacer"],NOTIF_TESTIMONIAL:['<a href="',"${personUrl}",'">',"${personName}",'</a> te escribió un <a href="',"${testimonialUrl}",'">testimonio</a>.'],GROUP_INVITE_ACCEPT:["Aceptar invitación"],GROUP_INVITE_NO_THANKS:["No, gracias"],GROUP_INVITE_ACCEPTED:["Invitación aceptada"],GROUP_INVITE_DECLINED:["Invitación rechazada"],FLICKRMAIL_HAS_MOVED:['¡FlickrMail se ha movido a tu menú de configuración! <a class="open-account-droparound-button" role="button" >Abrir menú</a>'],NOTIF_CONTACT_UPLOAD:['Your contact <a href="',"${personUrl}",'">',"${personName}","</a> uploaded new photos."],NOTIF_1_PERSON_FAVED_X_PHOTOS:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> faved ","${photoCountString}"," ",{type:"select",valueName:"mediaType",options:{photo:["photos"],video:["videos"],other:["photos"]}},"."],NOTIF_1_PERSON_FAVED_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> faved <a class="photo-link" href="',"${photoUrl}",'">“',"${photoTitle}","”</a>."],NOTIF_X_PEOPLE_FAVED_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}",' others faved <a class="photo-link" href="',"${photoUrl}",'">“',"${photoTitle}","”</a>."],NOTIF_1_PERSON_COMMENTED_X_PHOTOS:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> commented on ","${photoCountString}"," ",{type:"select",valueName:"mediaType",options:{photo:["photos"],video:["videos"],other:["photos"]}},"."],NOTIF_1_PERSON_COMMENTED_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> commented on your photo: <a class="comment-link" href="',"${commentUrl}",'">“',"${commentContent}","”</a>"],NOTIF_X_PEOPLE_COMMENTED_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}",' others commented on <a class="photo-link" href="',"${photoUrl}",'">“',"${photoTitle}","”</a>."],NOTIF_1_PERSON_FOLLOWED_YOU:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> is now following you!"],NOTIF_X_PEOPLE_FOLLOWED_YOU:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}"," others are now following you!"],NOTIF_1_PERSON_LEFT_NOTE_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> left a note on your photo: <a class="note-link" href="',"${noteUrl}",'">“',"${noteContent}","”</a>"],NOTIF_X_PEOPLE_LEFT_NOTE_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}",' others left notes on <a class="photo-link" href="',"${photoUrl}",'">“',"${photoTitle}","”</a>."],NOTIF_1_PERSON_TAGGED_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> tagged your photo with <a class="tag-link" href="',"${tagUrl}",'">“',"${tagName}","”</a>."],NOTIF_X_PEOPLE_TAGGED_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}",' others tagged <a class="photo-link" href="',"${photoUrl}",'">“',"${photoTitle}","”</a>."],NOTIF_1_PERSON_TESTIMONIAL:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> wrote you a testimonial: <a class="testimonial-link" href="',"${testimonialUrl}",'">“',"${testimonialContent}","”</a>"],NOTIF_1_PERSON_FLICKRMAIL:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> sent you a message: <a class="flickrmail-link" href="',"${flickrmailUrl}",'">“',"${flickrmailContent}","”</a>"],NOTIF_1_PERSON_COMMENT_MENTIONED_YOU_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> mentioned you in a comment: <a class="comment-link" href="',"${commentUrl}",'">“',"${commentContent}","”</a>"],NOTIF_X_PEOPLE_COMMENT_MENTIONED_YOU_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}",' others mentioned you in <a class="comments-link" href="',"${commentsUrl}",'">comments</a>.'],NOTIF_1_PERSON_ADDED_1_PHOTO_TO_GALLERY:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> added your photo to the gallery <a class="gallery-link" href="',"${galleryUrl}",'">',"${galleryTitle}","</a>."],NOTIF_X_PEOPLE_ADDED_1_PHOTO_TO_GALLERIES:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}"," others added your photo to galleries."],NOTIF_1_PERSON_COMMENTED_ON_1_GALLERY:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> commented on your gallery <a class="gallery-link" href="',"${galleryUrl}",'">',"${galleryTitle}",'</a>: <a class="comment-link" href="',"${commentUrl}",'">“',"${commentContent}","”</a>"],NOTIF_X_PEOPLE_COMMENTED_ON_1_GALLERY:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}",' others commented on your gallery <a class="gallery-link" href="',"${galleryUrl}",'">',"${galleryTitle}","</a>."],NOTIF_1_PERSON_SHARED_1_PHOTO:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> shared the photo <a class="photo-link" href="',"${photoUrl}",'">“',"${photoTitle}","”</a> with you."],NOTIF_1_PERSON_INVITED_1_PHOTO_TO_GROUP:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> invited you to add your photo to the group <a class="group-link" href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_1_PERSON_INVITED_YOU_TO_GROUP:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> invited you to the group <a class="group-link" href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_1_PERSON_CREATED_TOPIC:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> created the topic <a class="topic-link" href="',"${topicUrl}",'">',"${topicName}","</a>."],NOTIF_X_PEOPLE_CREATED_TOPICS:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}",' others created the topic <a class="topics-link" href="',"${topicsUrl}",'">new discussion topics</a>.'],NOTIF_1_PERSON_REPLIED_TO_TOPIC:['<a class="person-link" href="',"${personUrl}",'">',"${personName}",'</a> replied to <a class="topic-link" href="',"${topicUrl}",'">',"${topicName}",'</a>:  <a class="reply-link" href="',"${replyUrl}",'">“',"${replyContent}","”</a>"],NOTIF_X_PEOPLE_REPLIED_TO_TOPIC:['<a class="person-link" href="',"${personUrl}",'">',"${personName}","</a> and ","${personCountString}",' others replied to <a class="topic-link" href="',"${topicUrl}",'">',"${topicName}","</a>."],NOTIF_GROUP_ADMIN_APPROVED_1_PHOTO:['An admin approved your photo for <a class="group-link" href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_GROUP_ADMIN_APPROVED_X_PHOTOS:["An admin approved ","${photoCountString}",' photos for <a class="group-link" href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_GROUP_ADMIN_REJECTED_1_PHOTO:['An admin rejected your photo for <a class="group-link" href="',"${groupUrl}",'">',"${groupName}","</a>."],NOTIF_GROUP_ADMIN_REJECTED_X_PHOTOS:["An admin rejected ","${photoCountString}",' photos for <a class="group-link" href="',"${groupUrl}",'">',"${groupName}","</a>."]})},"@VERSION@",{requires:["intl"]});YUI.add("notifications-view",function(t,i){require("hermes-core/flog")(i);t.namespace("Views")[this.name]=t.Base.create("notifications-view",t.FlickrView,[],{langBundles:this.details.langBundles,registries:{person:"person-models",photo:"photo-models",group:"group-info-models",gallery:"gallery-models"},initializer:function(t){var i=this.appContext.getViewer();return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.nsid=i&&i.signedIn?i.nsid:void 0,t.nsid=this.nsid,this.pageNum=0,this.pageSize=30,this.isFetchingNotifs=!1,this.scrollBottomLoadDist=300,this.endOfNotifs=!1,this.shouldFetchNotifs=t.shouldFetchNotifs,this.height=t.height,this.width=t.width,this.listHeight=t.listHeight,this.overflowX=t.overflowX,this.overflowY=t.overflowY,this.notifFilter=t.notifFilter,this},loadState:function(){return this},buildContainer:function(){return this.setContainerWithTemplate("notifications",{notifications:[],height:this.height,width:this.width,listHeight:this.listHeight,overflowX:this.overflowX,overflowY:this.overflowY}),this},activate:function(){var t,i,e,o,n=this;return n.scrollContainer=n.get("container").one(".notifications-list"),n.scrollContainerElement=this.scrollContainer.getDOMNode(),this.registerEventHandler(n.scrollContainer.on("scroll",n.handleScrollNotifications.bind(n))),n.get("personNotificationsModels")?n.getMoreNotifications():(t=this.appContext.getViewer(),this.appContext.getModel("person-notifications-models",t.nsid).then(function(t){n.set("personNotificationsModels",t),i=t.getValue("notifications").size(),e=t.getValue("unseenNotificationCount"),n.shouldFetchNotifs&&0!==e||0===i||t.getValue("muteChanged")?(n.shouldFetchNotifs=!1,t.setValue("unseenNotificationCount",0),t.setValue("muteChanged",!1),n.get("container").one(".notifications-list").addClass("loading"),n.getMoreNotifications()):(o=t.getValue("notifications").getList(),n.pageNum=Math.floor(i/n.pageSize),n.appendPage(o))})),this},handleScrollNotifications:function(t){this.isFetchingNotifs||this.scrollContainerElement.offsetHeight+this.scrollContainerElement.scrollTop+this.scrollBottomLoadDist>=this.scrollContainerElement.scrollHeight&&this.getMoreNotifications()},getMoreNotifications:function(){this.endOfNotifs||(this.isFetchingNotifs=!0,this.showBalls(this.get("container").one(".notifications-list")),this.retrieveNotifsPage())},appendPage:function(i){var e=this;i.forEach(function(i){var o=i.toJSON();o.appContext=e.appContext,o.notifModel=e.get("personNotificationsModels"),o.events&&0!==o.events.length&&new t.Views["notification-view"](o).initialize(o).then(function(n){var s=t.Node.create('<li class="notification-list-item"></li>');e.get("container").one(".notifications-list").append(s),o.seen||s.addClass("unseen"),s.setHTML(n.get("container")),i.setValue("seen",!0),n.activate()})})},showBalls:function(i){this.balls||(this.balls=t.Node.create('<li class="loading-balls"></li>'),this.balls.setHTML(this.templates("flickr-balls")({}))),(i||this.get("container")).append(this.balls)},hideBalls:function(){this.balls&&this.balls.remove()},retrieveNotifsPage:function(){var t=this,i=t.get("personNotificationsModels");return i.getValue("notifications").getPage({page:t.pageNum+1,apiParams:{filter:t.notifFilter}}).then(function(e){return 0!==e.length?(t.pageNum++,t.set("personNotifications",i.getValue("notifications")),t.appendPage(e)):(0===t.pageNum&&t.get("container").one(".notifications-empty-state").removeClass("hidden"),t.endOfNotifs=!0),t.get("container").one(".notifications-list").removeClass("loading"),t.hideBalls(),t.isFetchingNotifs=!1,t},function(t){}).then(function(t){t.registerEventHandler(t.get("container").all("a").on("focus",function(i){var e=i.target.ancestor("li");e&&t.findFocus.call(this,e)}.bind(t)))})},findFocus:function(t){var i,e=t.one("a.photo");e?e.focus():(i=t.one("a:first-child"))&&i.focus()}})},"@VERSION@",{requires:["flickr-view","hermes-template-notifications"],langBundles:["common","notifications"],optional:["person-notifications-models","notification-view","photo-models","group-info-models","person-models","gallery-models"]});YUI.add("hermes-template-notifications-panel",function(t,a){var n=t.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(t,a,n,e,s){var i=null!=a?a:{},l=n.helperMissing,o=t.escapeExpression;return'<div class="notifications-panel">\n\t<div class="nav-container">\n\t\t<div class="tabs">\n\t\t\t<span role="button" class="tab selected" data-tab-id="main">'+o((n.intlMessage||a&&a.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"notifications.NOTIFICATIONS"},data:s}))+'</span>\n\t\t\t<span role="button" class="tab" data-tab-id="admin">TMP Groups You Admin</span>\n\t\t</div>\n\t\t<div class="actions">\n\t\t\t<a class="action settings-link" href="/account/email">\n\t\t\t\t<svg class="icon"><use xlink:href="#icon-settings"></use></svg>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n\t<div class="list-container">\n\t\t'+o((n.outlet||a&&a.outlet||l).call(i,null!=a?a["notifications-list-view"]:a,{name:"outlet",hash:{},data:s}))+'\n\t</div>\n\t<a class="foot-link" href="/">\n\t\tTMP View all notifications\n\t</a>\n</div>\n'},useData:!0}),e={};t.Array.each([],function(a){var n=t.Template.get("hermes/"+a);n&&(e[a]=n)}),t.Template.register("hermes/notifications-panel",function(a,s){return s=s||{},s.partials=s.partials?t.merge(e,s.partials):e,n(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("template-lib-helper",function(e,t){var r=require("hermes-core/flog")(t);e.TemplateLibraryHelper=function(t,l){var n=l&&l.localizeLib?l.localizeLib:e.mix({langBundles:["common"]},e.Localizable),i={getTemplate:function(l,i){var o,a=e.Template.get("hermes/"+l),p=n.getLangBundles();if(p.locales=t.lang||n.defaultLang,"function"!=typeof a)throw r.error("Template not found",{topic:this.name,template:l}),new Error("Template not found: "+l);return t.flipper&&(o=t.flipper),function(e){return!(e=e||{}).flippers&&o&&(e.flippers=o.toJSON()),i&&(e.isMobile=i.isMobile,e.cspNonce=i.cspNonce),a(e,{data:{intl:p,flippers:e.flippers}})}}};return e.augment(i,e.EventTarget),i}},"@VERSION@",{requires:["event-custom"]});YUI.add("group-status-helper",function(e,t){require("hermes-core/flog")(t);var n=e.mix({langBundles:["common","groups"]},e.Localizable);e.GroupStatusHelper=function(t,o){var i,s,a=o.groupId,r=new e.TemplateLibraryHelper(t),u={load:function(){var n=this;return e.on("groupStatusHelper:groupStatusChanged",function(e){e.groupId===a&&n.update()}),o.useSearchModel?t.getModel("search-group-models",a).then(function(e){s=e,n.convertGroupInfoModel(e),n.groupRemoteMethods={join:e.registry.remote.join,leave:e.registry.remote.leave}}):t.getModel("group-info-models",a).then(function(e){return s=e,n.convertGroupInfoModel(e),n.groupRemoteMethods={join:e.registry.remote.join,leave:e.registry.remote.leave},e})},initiateJoinGroup:function(){var o=this.getJoinStatus(),s=i.title,a=i.id;if(o.canJoin&&!o.signedIn)return this.signInAndRedirectToGroup(a);if(o.canJoin&&!o.requiresRequest)return this.joinGroup(a);if(o.canJoin&&o.isInvited)return this.joinGroup(a);if(!o.hasJoined&&o.hasRequested&&o.requiresRequest){new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"groups.GROUP_INVITE_ONLY_HEADER",groupName:s}),message:n.intlMessage({intlName:"groups.GROUP_INVITE_PENDING",groupName:s}),actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()}else{if(!o.hasJoined&&!o.hasRequested&&o.requiresRequest)return this.promptForRules().then(e.bind(function(){this.showInviteRequestModal.call(this,a)},this),e.bind(function(){},this));if(o.hasJoined)return e.Promise.resolve()}},initiateLeaveGroup:function(){this.showLeaveGroupModal()},showLeaveGroupModal:function(){var o=i.title,s=i.id,a=null,r="";1===i.memberCount&&i.isMember?r=n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_LAST_MEMBER",title:o}):i.isAdmin?(r=n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_ADMIN",title:o}),r+=n.intlHTMLMessage({intlName:"groups.GROUPS_LEAVE_WARNING_REMOVE_PHOTOS"})):(r=n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING",title:o}),r+=n.intlHTMLMessage({intlName:"groups.GROUPS_LEAVE_WARNING_REMOVE_PHOTOS"})),(a=new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_TITLE",title:o}),htmlMessage:r,actionButtonLabel:n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_LEAVE_BUTTON"}),cancelButtonLabel:n.intlMessage({intlName:"groups.GROUPS_LEAVE_WARNING_CANCEL_BUTTON"}),overlayClassList:"over-droparound-under-modal"})).on("actionClick",e.bind(function(){var e=a.get("container").one("input"),t=e&&e.getDOMNode().checked;this.leaveGroup(s,t)},this)),a.show()},joinGroup:function(){var o=this;return this.promptForRules().then(e.bind(function(){return this.groupRemoteMethods.join({groupModel:s,acceptRules:!0},t).then(function(t){return o.convertGroupInfoModel(t),o.fire("groupJoined"),e.fire("groupStatusHelper:groupJoined",{groupId:a}),e.fire("groupStatusHelper:groupStatusChanged",{groupId:a}),t},function(o){new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"common.OOPS"}),message:n.intlMessage({intlName:"groups.GROUP_JOIN_ERROR"}),actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()})},this),e.bind(function(e){},this))},leaveGroup:function(o,i){var a=this;this.groupRemoteMethods.leave({groupModel:s,deletePhotos:!!i},t).then(function(t){return a.convertGroupInfoModel(t),a.fire("groupLeft"),e.fire("groupStatusHelper:groupLeft",{groupId:o}),e.fire("groupStatusHelper:groupStatusChanged",{groupId:o}),t},function(o){new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"common.OOPS"}),message:n.intlMessage({intlName:"groups.GROUP_LEAVE_ERROR"}),actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()})},signInAndRedirectToGroup:function(o){var s,a=this,r=e.url("/groups/")+o,u=n.intlMessage({intlName:"groups.SIGN_IN_BEFORE_JOIN_MESSAGE",name:i.title}),l=n.intlMessage({intlName:"groups.SIGN_IN_AND_JOIN"}),g=n.intlMessage({intlName:"common.CANCEL"});if(this.signedOutTest)return this.showSignUpModal(o);(s=new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"groups.SIGN_IN_BEFORE_JOIN_TITLE"}),htmlMessage:u,actionButtonLabel:l,cancelButtonLabel:g})).on("actionClick",function(){e.rapidTracker.beacon(a.name,"joinModalSigninClick"),e.SigninHelper.addPendingJoinGroup({id:o},{postLoginUrl:r})}),s.on("cancelClick",function(t){e.rapidTracker.beacon(a.name,"joinModalCancelClick")}),s.show()},showSignUpModal:function(o){var s,a=e.url("/groups/")+o,r=n.intlMessage({intlName:"groups.SIGN_IN_BEFORE_JOIN_TITLE"}),u=n.intlMessage({intlName:"groups.SIGN_UP_AND_JOIN_MESSAGE",name:i.title});(s=new e.Views.SignUpModal({appContext:t,signUpHeaderClass:"avatar group big",signUpHeaderImage:void 0!==this.groupModel.getValue("group")?this.groupModel.getValue("group").getValue("bestIconURL"):this.groupModel.getValue("bestIconURL"),signUpTitle:r,signUpMessage:u,beaconPrefix:"join"})).on("signUpClick",function(t){e.SigninHelper.signUpPendingJoinGroup({id:o},{postLoginUrl:a})}),s.on("signInClick",function(t){e.SigninHelper.addPendingJoinGroup({id:o},{postLoginUrl:a})}),s.show()},promptForRules:function(){return new e.Promise(e.bind(function(o,s){var a=i.secureRules,r=null;a?((r=new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"groups.GROUP_JOIN_RULES_DIALOG_TITLE"}),htmlMessage:n.intlMessage({intlName:"groups.GROUP_JOIN_RULES_DIALOG_MESSAGE"})+"<br /><pre>"+a+"</pre>",showBodyLines:!1,actionButtonLabel:n.intlMessage({intlName:"groups.GROUP_JOIN_RULES_DIALOG_ACCEPT"}),cancelButtonLabel:n.intlMessage({intlName:"groups.GROUP_JOIN_RULES_DIALOG_DECLINE"})})).on("actionClick",function(){setTimeout(function(){o()},500)}),r.on("cancelClick",function(){setTimeout(function(){s()},500)}),r.show()):o()},this))},showInviteRequestModal:function(s){var a,u=n.intlMessage({intlName:"groups.GROUP_INVITE_ONLY_SEND"}),l=n.intlMessage({intlName:"common.CANCEL"}),g=r.getTemplate("join-group-invite-form",o.viewParams);(a=new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"groups.GROUP_INVITE_ONLY_HEADER",groupName:e.Escape.html(i.title)}),htmlMessage:g({groupName:i.title}),actionButtonLabel:u,cancelButtonLabel:l})).on("actionClick",function(){var o=a.get("container").one(".group-invite-form");if(o){var r=o.get("value");if(r.length>0){var u={group_id:s,message:r,accept_rules:!0};t.callAPI("flickr.groups.joinRequest",u).then(function(t){e.config.win.location.reload()},function(o){var s="";s=o&&7===o.code?n.intlMessage({intlName:"groups.GROUP_INVITE_PENDING",groupName:e.Escape.html(i.title)}):"message"in o?o.message:n.intlMessage({intlName:"common.ERROR"}),new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"common.ERROR"}),message:s,actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()})}else setTimeout(function(){new e.Views.FluidModal({appContext:t,title:n.intlMessage({intlName:"common.ERROR"}),message:n.intlMessage({intlName:"groups.GROUP_INVITE_EMPTY_MESSAGE"}),actionButtonLabel:n.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},300)}}),a.on("activated",function(){var e=a.get("container"),t=e.one("textarea")||!1;e&&t&&t.focus()}),a.show()},getJoinStatus:function(){var e=!1,n=!1,o=!1,s=!1,a=!1,r=t&&t.getViewer(),u=r&&r.signedIn;return e=i.isMember,a=i.isInvited,o=i.hasPendingRequestToJoin,n=2===i.privacy,s=i.isAdmin,{signedIn:u,canJoin:!e&&!o,hasJoined:e,hasRequested:o,isInvited:a,requiresRequest:n,isAdmin:s}},convertGroupInfoModel:function(e){var t=o.useSearchModel?e:e.getValue("group");i={title:t.getValue("title"),id:t.getValue("id"),memberCount:t.getValue("memberCount"),isMember:t.getValue("isMember"),isModerator:t.getValue("isModerator"),isAdmin:t.getValue("isAdmin"),privacy:t.getValue("privacy"),isInvited:e.getValue("isInvited"),hasPendingRequestToJoin:e.getValue("hasPendingRequestToJoin"),secureRules:e.getValue("secureRules")}},getInfo:function(){return{groupAttrs:i,joinStatus:this.getJoinStatus()}},toggleMuteGroup:function(t){var n={object_id:a,object_type:1,pref_type:"GroupBatch",pref_val:t?0:1};return this.insertUserPrefs(n).then(function(n){e.fire("groupStatusHelper:groupMuteToggled",{groupId:a,isMuted:t}),e.fire("groupStatusHelper:groupStatusChanged",{groupId:a})})},insertUserPrefs:function(e){return t.callAPI("flickr.feed.preferences.insertUserPreferences",e)},update:function(){this.convertGroupInfoModel(s)}};return e.augment(u,e.EventTarget),u}},"@VERSION@",{requires:["event-custom","template-lib-helper"]});YUI.add("base-notification-item-view",function(t,e){require("hermes-core/flog")(e);t.namespace("Views")[this.name]=t.Base.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,additionalViewClasses:function(){return["base-notification-item"]},initializer:function(e){this.params=e,this.activityItem=e.activityItem,this.notificationsHelper=new t.NotificationsHelper(this.appContext)},loadState:function(){return t.Promise.resolve()},buildContainer:function(){var t=this.notificationsHelper.getTemplateHtml(this.activityItem);this.setContainerHTML(t)},activate:function(){this.get("container");return this.setupContextMenu(),this},handleContextMenuClick:function(){var e,n,i;this.menuConfigData&&(n=(e=this.notificationsHelper.getContextMenuConfig(this.menuConfigData)).actionList.map(function(t){return{text:t.text,value:t.actionId}}),(i=new t.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorOffsetHorizontal:12,anchorOffsetVertical:0,width:250,dismissOnOverlayClick:!0,anchorElement:this.contextMenuButton,menuItems:n,positionFixed:!0,classList:"over-modal notification-context-menu",overlayClassList:"over-modal"})).show(),this.registerEventHandler(i.on("selected",function(t){e.actionList.find(function(e){return e.actionId===t.menuItem.value}).onSelected(t),i.close()})))},setupContextMenu:function(){var t=this,e=this.get("container"),n=this.params.activityItem;return this.contextMenuButton=e.one(".notification-context-menu-button"),this.contextMenuButton&&this.registerEventHandler(this.contextMenuButton.on("click",this.handleContextMenuClick.bind(this))),this.notificationsHelper.loadContextMenuConfig(n).then(function(e){t.menuConfigData=e})}})},"@VERSION@",{requires:["flickr-view"],langBundles:["common","relative-dates","notifications"]});