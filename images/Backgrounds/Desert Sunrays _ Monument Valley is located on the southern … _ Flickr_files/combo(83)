YUI.add("hermes-template-photo-sidebar-actions",function(e,a){var t=e.Template.Handlebars.revive({1:function(e,a,t,n,l){var r;return e.escapeExpression((t.formatNumber||a&&a.formatNumber||t.helperMissing).call(null!=a?a:{},null!=(r=null!=a?a.photo:a)?r.commentCount:r,{name:"formatNumber",hash:{},data:l}))},3:function(e,a,t,n,l){var r;return e.escapeExpression((t.friendlyNumber||a&&a.friendlyNumber||t.helperMissing).call(null!=a?a:{},null!=(r=null!=a?a.photo:a)?r.commentCount:r,{name:"friendlyNumber",hash:{},data:l}))},compiler:[7,">= 4.0.0"],main:function(e,a,t,n,l){var r,s=null!=a?a:{},o=t.helperMissing,u=e.escapeExpression;return u((t.outlet||a&&a.outlet||o).call(s,null!=a?a["fave-view"]:a,{name:"outlet",hash:{},data:l}))+'\n<div>\n\t<a title="Comment" class="button comment" href="#">\n\t\t<span class="ui-icon-comments">&nbsp;</span>\n\t\t<span class="button-comment-count">'+(null!=(r=t.if.call(s,null!=a?a.realFullscreen:a,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),data:l}))?r:"")+"</span>\n\t</a>\n</div>\n"+u((t.outlet||a&&a.outlet||o).call(s,null!=a?a["share-view"]:a,{name:"outlet",hash:{},data:l}))+"\n"+u((t.outlet||a&&a.outlet||o).call(s,null!=a?a["photo-sidebar-toggle-view"]:a,{name:"outlet",hash:{},data:l}))},useData:!0}),n={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(n[a]=t)}),e.Template.register("hermes/photo-sidebar-actions",function(a,l){return l=l||{},l.partials=l.partials?e.merge(n,l.partials):n,t(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-fave",function(n,e){var a=n.Template.Handlebars.revive({1:function(n,e,a,l,t){return"is-faved"},3:function(n,e,a,l,t){return"can-not-fave"},5:function(n,e,a,l,t){return'\t\t\t<svg class="icon icon-heart"><use xlink:href="#icon-heart"></use></svg>\n\t\t\t<svg class="icon icon-heart_hollow"><use xlink:href="#icon-heart_hollow"></use></svg>\n'},7:function(n,e,a,l,t){return'\t\t\t<svg class="icon icon-thumb"><use xlink:href="#icon-thumb"></use></svg>\n\t\t\t<svg class="icon icon-thumb_hollow"><use xlink:href="#icon-thumb_hollow"></use></svg>\n'},9:function(n,e,a,l,t){return'\t\t\t<i class="animated-fave-star"></i>\n'},11:function(n,e,a,l,t){return'\t\t\t<svg class="icon icon-fave"><use xlink:href="#icon-fave"></use></svg>\n\t\t\t<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n'},13:function(n,e,a,l,t){var r;return n.escapeExpression((a.formatNumber||e&&e.formatNumber||a.helperMissing).call(null!=e?e:{},null!=(r=null!=e?e.photo:e)?r.faveCount:r,{name:"formatNumber",hash:{},data:t}))},15:function(n,e,a,l,t){var r;return null!=(r=a.if.call(null!=e?e:{},null!=(r=null!=e?e.photo:e)?r.faveCount:r,{name:"if",hash:{},fn:n.program(16,t,0),inverse:n.noop,data:t}))?r:""},16:function(n,e,a,l,t){var r;return n.escapeExpression((a.friendlyNumber||e&&e.friendlyNumber||a.helperMissing).call(null!=e?e:{},null!=(r=null!=e?e.photo:e)?r.faveCount:r,{name:"friendlyNumber",hash:{},data:t}))},compiler:[7,">= 4.0.0"],main:function(n,e,a,l,t){var r,s,o=null!=e?e:{},i=a.helperMissing;return'<div class="button">\n\t<a class="fave-star '+n.escapeExpression("function"==typeof(s=null!=(s=a.alternateFaveUIStyle||(null!=e?e.alternateFaveUIStyle:e))?s:i)?s.call(o,{name:"alternateFaveUIStyle",hash:{},data:t}):s)+" "+(null!=(r=a.if.call(o,null!=(r=null!=e?e.photo:e)?r.isFaved:r,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.noop,data:t}))?r:"")+" "+(null!=(r=a.unless.call(o,null!=(r=null!=e?e.photo:e)?r.canFave:r,{name:"unless",hash:{},fn:n.program(3,t,0),inverse:n.noop,data:t}))?r:"")+'">\n'+(null!=(r=(a.ifCond||e&&e.ifCond||i).call(o,null!=e?e.alternateFaveUIStyle:e,"===","heart",{name:"ifCond",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t}))?r:"")+"\n"+(null!=(r=(a.ifCond||e&&e.ifCond||i).call(o,null!=e?e.alternateFaveUIStyle:e,"===","thumb",{name:"ifCond",hash:{},fn:n.program(7,t,0),inverse:n.noop,data:t}))?r:"")+"\n"+(null!=(r=(a.ifCond||e&&e.ifCond||i).call(o,null!=e?e.alternateFaveUIStyle:e,"===","animated",{name:"ifCond",hash:{},fn:n.program(9,t,0),inverse:n.noop,data:t}))?r:"")+"\n"+(null!=(r=(a.ifCond||e&&e.ifCond||i).call(o,null!=e?e.alternateFaveUIStyle:e,"===","star_control",{name:"ifCond",hash:{},fn:n.program(11,t,0),inverse:n.noop,data:t}))?r:"")+"\n"+(null!=(r=a.unless.call(o,null!=e?e.alternateFaveUIStyle:e,{name:"unless",hash:{},fn:n.program(11,t,0),inverse:n.noop,data:t}))?r:"")+'\t</a>\n\t\n\t<span class="fave-count" unselectable="on">'+(null!=(r=a.if.call(o,null!=e?e.realFullscreen:e,{name:"if",hash:{},fn:n.program(13,t,0),inverse:n.program(15,t,0),data:t}))?r:"")+"</span>\n</div>\n"},useData:!0}),l={};n.Array.each([],function(e){var a=n.Template.get("hermes/"+e);a&&(l[e]=a)}),n.Template.register("hermes/fave",function(e,t){return t=t||{},t.partials=t.partials?n.merge(l,t.partials):l,a(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("fave-view",function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.offNetworkFave=e.offNetworkFave||!1,this.hideWhoFaved=e.hideWhoFaved||!1,this.alternateFaveUIStyle=!1,""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("fave",{photo:{canFave:!1},loadingView:!0}),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this.appContext.flipper.isFlipped("enable-alt-fave-style")&&(this.alternateFaveUIStyle=this.appContext.flipper.isFlipped("enable-alt-fave-style")),this.realFullscreen=!!e.realFullscreen,this},buildContainer:function(){var e=this.get("photo-engagement");return this.setContainerWithTemplate("fave",{photo:e.toJSON(),realFullscreen:this.realFullscreen,alternateFaveUIStyle:this.alternateFaveUIStyle}),this},loadState:function(){var t=this,i=this.appContext.getViewer(),n=[];return n.push(this.appContext.getModel("photo-engagement-models",this.photoId).then(function(e){t.set("photo-engagement",e)})),i.signedIn&&n.push(this.appContext.getModelRegistry("favorite-models").then(function(e){t.set("favoriteModelRegistry",e)})),i.signedIn&&t.appContext.getModel("person-models",i.nsid).then(function(e){t.set("viewer-person-model",e)}),e.Promise.all(n)},activate:function(){var t,n=this.get("photo-engagement"),a=this,s=this.appContext.getViewer().nsid,o=this.get("container"),l=o.one(".fave-star");return n&&this.registerEventHandler(n.on("valuesChanged",function(o){if(void 0!==o.faveCount||void 0!==o.isFaved||void 0!==o.canFave){o&&o.isFaved&&o.isFaved.newVal&&l.addClass("is-transitioning"),setTimeout(function(){o&&o.isFaved&&o.isFaved.newVal?l.addClass("is-faved"):l.removeClass("is-faved")},300),setTimeout(function(){l.removeClass("is-transitioning")},300);var r=a.get("favoriteModelRegistry");r&&r.exists&&r.exists(s)&&(t=r.proxy(s).getValue("photoPageList"),o.isFaved&&o.isFaved.newVal?a.appContext.getModel("photo-models",o.isFaved.id).then(function(e){t.unshift(e)}):t.remove(o.isFaved.id)),n.remoteUpdate().then(function(){a.processingFave=!1},function(t){3!==t.code&&(5!==t.code&&e.Object.each(o,function(e,t){n.setValue(t,e.prevVal)}),a.fire("subviewViewEvent","getDialogOffset",function(t){new e.Views.FluidModal({appContext:this.appContext,title:a.intlMessage({intlName:"common.ERROR"}),message:a.intlMessage({intlName:"fave-view.COULDNT_FAVE"}),actionButtonLabel:a.intlMessage({intlName:"common.OK"}),showCancelButton:!1,classList:"scrappy-dialog"}).show()})),a.processingFave=!1}).then(null,function(e){a.processingFave=!1,i.error({err:e})})}},a.photoId)),this.registerEventHandler(o.delegate("click",a.faveStarClicked,".fave-star",a)),this.registerEventHandler(this.appContext.getKeyboardManager().on("down:70",a._params.keyEventScope,a.faveStarClicked.bind(a))),this},showSignUpAndFaveModal:function(t){var i,n=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),a=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});(i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:n,signUpMessage:a,beaconPrefix:"fave"})).on("signUpClick",function(i){e.SigninHelper.signUpPendingFave({id:t})}),i.on("signInClick",function(i){e.SigninHelper.addPendingFave({id:t})}),i.show()},faveStarClicked:function(t,i){var n,a=this,s=this.get("photo-engagement"),o=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_MESSAGE"}),l=this.intlMessage({intlName:"fave-view.SIGN_IN_AND_FAVE"}),r=this.intlMessage({intlName:"common.CANCEL"});if(("keyup"!==t.type||70===t.keyCode)&&(t.preventDefault(),!this.processingFave))if(e.rapidTracker.beacon(this.name,"faveButtonClick"),this.processingFave=!0,this.bringIntoFocus(),this.appContext.getViewer().signedIn)s.getValue("canFave")&&(s.registry.toggleFave(this.photoId),e.rapidTracker.beacon(this.name,"faveStarActionBarButtonClick"));else{if(this.offNetworkFave)return e.SigninHelper.addPendingFave({id:this.photoId},{withPopup:!0,closeWhenDone:!0}),void(this.processingFave=!1);if(this.signedOutTest)return this.processingFave=!1,this.showSignUpAndFaveModal(this.photoId);(n=new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),htmlMessage:o,actionButtonLabel:l,cancelButtonLabel:r})).on("actionClick",function(){e.rapidTracker.beacon(a.name,"faveModalSigninClick"),e.SigninHelper.addPendingFave({id:a.photoId})}),n.on("cancelClick",function(t){e.rapidTracker.beacon(a.name,"faveModalCancelClick")}),n.show(),this.processingFave=!1}}})},"@VERSION@",{requires:["flickr-view","hermes-template-fave","fluid-modal-view","signin-helper","hermes-template-fave-menu","hermes-template-person","animation-manager"],optional:["photo-engagement-models","photo-people-who-faved-models","person-models","favorite-models"],langBundles:["fave-view","common"]});YUI.add("photo-sidebar-actions-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"fave-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-sidebar-toggle-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,inlineStyling:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-similarity-search-from-photo-page")}}},initializer:function(e){return this.photoId=e.photoId,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.realFullscreen=!!e.realFullscreen,this.isFullscreen=this.appContext.experiments.fullscreen.getMode(),this.signinPendingQueue=e.signinPendingQueue,this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-engagement-models",t.photoId),t.appContext.getModel("photo-models",t.photoId)]).then(function(e){t.set("photo-engagement",e[0]),t.set("photo",e[1])})},buildContainer:function(){var e=this.get("photo-engagement");return this.setContainerWithTemplate("photo-sidebar-actions",{photo:e.toJSON(),realFullscreen:this.realFullscreen,"is-fullscreen":this.isFullscreen,"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):""}),this},commentClicked:function(t){var i=this;if(!t.ctrlKey){var n,o;t.preventDefault(),t.stopPropagation(),this.appContext.experiments.fullscreen.getMode()&&this.appContext.getViewer().signedIn?(setTimeout(function(){e.fire("flickr:photo-sidebar-actions-focus-comment-form")},1500),this.appContext.flapp.navigate(e.config.doc.location.href.replace("/lightbox",""))):this.appContext.getViewer().signedIn?(o=this.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"))&&o.focus():((n=new e.Views.FluidModal({title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.SIGN_IN"}),cancelButtonLabel:this.intlMessage({intlName:"photo-sidebar-actions-view.CANCEL"}),htmlMessage:this.intlMessage({intlName:"photo-sidebar-actions-view.SIGN_IN_TO_COMMENT"}),appContext:this.appContext,classList:"scrappy-dialog",dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0})).on("actionClick",function(t){e.SigninHelper.addPendingComment({id:i.photoId})}),n.show()),e.rapidTracker.beacon(this.name,"commentActionBarButtonClick")}},menuItemsOpened:function(t){this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()&&(t.preventDefault(),t.stopPropagation(),e.fire("flickr:photo-sidebar-fullscreen-expand"),65===t.keyCode?setTimeout(function(){e.fire("flickr:photo-page-open-add-gallery",t)},500):69===t.keyCode?setTimeout(function(){e.fire("flickr:photo-page-open-add-set",t)},500):71===t.keyCode?setTimeout(function(){e.fire("flickr:photo-page-open-add-group",t)},500):84===t.keyCode&&setTimeout(function(){e.fire("flickr:photo-page-open-add-tag",t)},500))},moreClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"detailedViewActionBarButtonClick")},downloadClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"downloadActionBarButtonClick")},infoClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"infoActionBarButtonClick")},activate:function(){var t,i=this.get("container"),n=this;return i&&(i.one(".comment")&&this.registerEventHandler(i.one(".comment").on("click",this.commentClicked,this)),e.on("flickr:photo-sidebar-actions-focus-comment-form",function(){n.get("container").ancestor(".photo-sidebar-view")?t=n.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"):(t=e.one(".sub-photo-comments-view textarea"))&&t.scrollIntoView(),t&&t.focus()}),this.appContext.experiments.fullscreen.getMode()&&(i.one(".more")&&this.registerEventHandler(i.one(".more").on("click",this.moreClicked,this)),i.one(".download")&&this.registerEventHandler(i.one(".download").on("click",this.downloadClicked,this)),i.one(".info")&&this.registerEventHandler(i.one(".info").on("click",this.infoClicked,this)))),this.get("photo-engagement")&&this.registerEventHandler(this.get("photo-engagement").on("valuesChanged",function(e){e.commentCount&&i.one(".comment span.button-comment-count").set("text",e.commentCount.newVal)})),this.attachKeyEvent("down:67",this.commentClicked.bind(this)),this.appContext.experiments.fullscreen.getMode()&&this.attachKeyEvent("down:71,65,69,84",this.menuItemsOpened.bind(this)),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-sidebar-actions","fluid-modal-view","signin-helper","fluid-share-photo-view"],optional:["fave-view","photo-engagement-models"],langBundles:["photo-sidebar-actions-view","photo-page-scrappy","common"]});YUI.add("hermes-lang-photo-sidebar-actions-view_es-us",function(e,i){e.Intl.add("hermes/photo-sidebar-actions-view","es-US",{OOPS:["¡Uy!"],SIGN_IN_TO_COMMENT:["¿Quieres hacer algún comentario? Inicia sesión e inténtalo de nuevo."],SIGN_IN:["Iniciar sesión"],CANCEL:["Olvídalo"]})},"@VERSION@",{requires:["intl"]});